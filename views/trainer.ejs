<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GymRats - Trainer Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/trainer/trainer.css" />
</head>

<body>
    <!-- Navigation -->
    <div class="main-navbar">
        <header>
            <div class="brand-logo">
                <a href="/home" class="brand-name">GymRats</a>
            </div>
            <div class="nav-menu">
                <a href="/home">Home</a>
                <a href="/isolation">Exercises</a>
                <a href="/nutrition">Nutrition</a>
                <a href="/about">About</a>
                <a href="/contact">Contact</a>
            </div>
            <div class="right-container">
                <div class="search-container">
                    <img src="/trainer/icons8-search.svg" height="18px" alt="Search Icon" />
                    <input type="text" placeholder="Search..." size="20" style="font-size: 14px;" />
                </div>
                <div class="login-button">
                    <a href="/trainer_login">Logout</a>
                </div>
            </div>
            <div class="mobile-menu-icon" id="menuIcon">
                <img src="/trainer/menu.jpg" alt="Menu" height="25px" />
            </div>
        </header>
    </div>

    <!-- Mobile Side Navigation -->
    <div class="mobile-sidebar" id="sideNavbar">
        <a href="javascript:void(0)" class="close-button" id="closeBtn">&times;</a>
        <a href="/home">Home</a>
        <a href="/isolation">Exercises</a>
        <a href="/nutrition">Nutrition</a>
        <a href="/about">About</a>
        <a href="/contact">Contact</a>
        <a href="/trainer_login">Logout</a>
    </div>

    <!-- Welcome Banner -->
    <div class="welcome-banner">
        <h1>Welcome, <%= trainer.name %></h1>
        <p>Manage your clients and track their progress</p>
    </div>

    <!-- Main Content Area -->
    <div class="main-content">
        <!-- Client List -->
        <div class="client-list-container">
            <h2>Client List</h2>
            <div class="client-list">
                <% if (clients.length === 0) { %>
                    <p>No clients assigned yet.</p>
                <% } else { %>
                    <% clients.forEach((client, index) => { %>
                        <div class="client-item <%= index === 0 ? 'active' : '' %>" data-client="<%= client.id %>">
                            <div class="client-name"><%= client.name %></div>
                            <div class="client-stats">
                                <span>Progress: <%= client.progress %>%</span>
                                <span>Next Session: <%= client.nextSession %></span>
                            </div>
                        </div>
                    <% }) %>
                <% } %>
            </div>
        </div>

        <!-- Client Details Container -->
        <div class="client-details-container">
            <!-- Top row -->
            <div class="top-row">
                <!-- Client Profile -->
                <div class="client-profile">
                    <h2>Client Profile: <span id="clientNameDisplay">
                        <%= selectedClient ? selectedClient.name : 'Select a client' %>
                    </span></h2>
                    <div class="profile-stats">
                        <div class="stat-item">
                            <span class="stat-label">Age:</span>
                            <span class="stat-value"><%= selectedClient ? selectedClient.age : 'N/A' %></span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Weight:</span>
                            <span class="stat-value"><%= selectedClient ? selectedClient.weight : 'N/A' %></span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Height:</span>
                            <span class="stat-value"><%= selectedClient ? selectedClient.height : 'N/A' %></span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Body Fat:</span>
                            <span class="stat-value"><%= selectedClient ? selectedClient.bodyFat : 'N/A' %></span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Goal:</span>
                            <span class="stat-value"><%= selectedClient ? selectedClient.goal : 'N/A' %></span>
                        </div>
                    </div>
                    <% if (selectedClient) { %>
                        <button class="btn meet-button" onclick="window.open('https://meet.google.com/xyz-abcd-123', '_blank')">Join Google Meet</button>
                    <% } %>
                </div>

                <!-- Workout Plan -->
                <div class="workout-plan">
                    <h2>Today's Workout: HIIT</h2>
                    <div class="exercises-list">
                        <div class="exercise-item">
                            <span class="exercise-name">1. Burpees</span>
                            <span class="exercise-details">4 sets x 15 reps</span>
                        </div>
                        <div class="exercise-item">
                            <span class="exercise-name">2. Squat/Lunges</span>
                            <span class="exercise-details">3 sets x 20 reps</span>
                        </div>
                        <div class="exercise-item">
                            <span class="exercise-name">3. Mountain Climbers</span>
                            <span class="exercise-details">4 sets x 30 seconds</span>
                        </div>
                        <div class="exercise-item">
                            <span class="exercise-name">4. Jumping Jacks</span>
                            <span class="exercise-details">3 sets x 45 seconds</span>
                        </div>
                    </div>
                    <button class="btn">Edit Workout Plan</button>
                </div>
            </div>

            <!-- Current Stats -->
            <div class="current-stats">
                <h2>Current Stats</h2>
                <div class="stats-grid">
                    <div class="stat-box">
                        <h3>Bicep Curls</h3>
                        <p class="stat-value">10 kg</p>
                    </div>
                    <div class="stat-box">
                        <h3>Deadlift</h3>
                        <p class="stat-value">100 kg</p>
                    </div>
                </div>
                <h3>Exercise Progress Timeline</h3>
                <div class="chart-container">
                    <canvas id="exerciseChart"></canvas>
                </div>
            </div>

            <!-- Nutrition Plan -->
            <div class="nutrition-plan">
                <h2>Food Intake</h2>
                <% if (selectedClient) { %>
                    <div class="nutrition-goal">
                        <p>Today's protein goal: N/A</p>
                        <p>Calories: N/A</p>
                    </div>
                    <h3>Foods to Take:</h3>
                    <div class="foods-to-take">
                        <p>No foods assigned yet.</p>
                    </div>
                    <div class="goals-reached">
                        <p>Food goals not set.</p>
                    </div>
                    <h3>Nutritional Breakdown</h3>
                    <div class="pie-chart-container">
                        <canvas id="nutritionChart"></canvas>
                    </div>
                    <a href="/edit_nutritional_plan/<%= selectedClient.id %>" class="btn">Edit Nutrition Plan</a>
                <% } else { %>
                    <p>Select a client to view or edit their nutrition plan.</p>
                <% } %>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-column">
                <h3>GymRats</h3>
                <ul>
                    <li><a href="/about">About Us</a></li>
                    <li><a href="/trainers">Our Trainers</a></li>
                    <li><a href="/testimonial">Testimonials</a></li>
                    <li><a href="/blog">Blog</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h3>Resources</h3>
                <ul>
                    <li><a href="/isolation">Exercise Guide</a></li>
                    <li><a href="/nutrition">Nutrition Tips</a></li>
                    <li><a href="/workout_plans">Workout Plans</a></li>
                    <li><a href="/calculators">Calculators</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h3>Support</h3>
                <ul>
                    <li><a href="/contact">Contact Us</a></li>
                    <li><a href="/about">About us</a></li>
                    <li><a href="/terms">Terms of Service</a></li>
                    <li><a href="/privacy_policy">Privacy Policy</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h3>Connect With Us</h3>
                <ul>
                    <li><a href="/trainer_form">Become a Trainer</a></li>
                    <li><a href="/verifier_login">Become a Verifier</a></li>
                </ul>
                <div class="social-icons">
                    <a href="#"><img src="/trainer/icons8-facebook.svg" alt="Facebook" height="24"></a>
                    <a href="#"><img src="/trainer/icons8-instagram.svg" alt="Instagram" height="24"></a>
                    <a href="#"><img src="/trainer/icons8-youtube.svg" alt="YouTube" height="24"></a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Mobile menu functionality
        document.getElementById('menuIcon').addEventListener('click', function () {
            document.getElementById('sideNavbar').style.width = "250px";
        });

        document.getElementById('closeBtn').addEventListener('click', function () {
            document.getElementById('sideNavbar').style.width = "0";
        });

        // Client selection functionality
        document.querySelectorAll('.client-item').forEach(item => {
            item.addEventListener('click', function () {
                document.querySelectorAll('.client-item').forEach(client => {
                    client.classList.remove('active');
                });
                this.classList.add('active');
                const clientId = this.dataset.client;
                console.log("Selected client: " + clientId);

                // Fetch updated client data via AJAX
                fetch(`/trainer/client/${clientId}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            console.error('Error fetching client data:', data.error);
                            return;
                        }
                        // Update client profile display
                        document.getElementById('clientNameDisplay').textContent = data.name;
                        document.querySelector('.stat-value[data-field="age"]').textContent = data.age || 'N/A';
                        document.querySelector('.stat-value[data-field="weight"]').textContent = data.weight || 'N/A';
                        document.querySelector('.stat-value[data-field="height"]').textContent = data.height || 'N/A';
                        document.querySelector('.stat-value[data-field="bodyFat"]').textContent = data.bodyFat || 'N/A';
                        document.querySelector('.stat-value[data-field="goal"]').textContent = data.goal || 'N/A';
                    })
                    .catch(error => {
                        console.error('Error fetching client data:', error);
                    });
            });
        });

        // Chart.js implementation for exercise progress
        const exerciseCtx = document.getElementById('exerciseChart').getContext('2d');
        const exerciseChart = new Chart(exerciseCtx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May'],
                datasets: [{
                    label: 'Bicep Curls (kg)',
                    data: [5, 6, 8, 9, 10],
                    borderColor: '#8A2BE2',
                    backgroundColor: 'rgba(138, 43, 226, 0.1)',
                    tension: 0.3
                }, {
                    label: 'Deadlift (kg)',
                    data: [60, 70, 80, 90, 100],
                    borderColor: '#20B2AA',
                    backgroundColor: 'rgba(32, 178, 170, 0.1)',
                    tension: 0.3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'top', labels: { color: '#f1f1f1' } }
                },
                scales: {
                    y: { beginAtZero: true, grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: '#f1f1f1' } },
                    x: { grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: '#f1f1f1' } }
                }
            }
        });

        // Chart.js implementation for nutrition
        const nutritionCtx = document.getElementById('nutritionChart').getContext('2d');
        const nutritionChart = new Chart(nutritionCtx, {
            type: 'doughnut',
            data: {
                labels: ['Protein', 'Carbs', 'Fats'],
                datasets: [{
                    data: [35, 45, 20],
                    backgroundColor: ['#8A2BE2', '#20B2AA', '#FF6347'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom', labels: { color: '#f1f1f1', padding: 10 } }
                }
            }
        });
    </script>
</body>
</html>